get folder ids and uids
{ final map long list string folder map = new hash map do batch set selection new batch set selection { override public int get list size { return message ids size } override public string get list item int index { return long to string message ids get index } override public void do db work sqlite database db string selection set string selection args throws unavailable storage exception { if threaded list { string sql = select m uid m folder id " + from threads t " + left join messages m on t message id = m id " + where m empty = 0 and m deleted = 0 " + and t root + selection set get data from cursor db raw query sql selection args } else { string sql = select uid folder id " + from messages " + where empty = 0 and id + selection set get data from cursor db raw query sql selection args } } private void get data from cursor cursor cursor { try { while cursor move to next { string uid = cursor get string long folder id = cursor get long list string uid list = folder map get folder id if uid list == null { uid list = new array list folder map put folder id uid list } uid list add uid } } finally { cursor close } } override public void post db work { notify change } }, uid check batch size return folder map

